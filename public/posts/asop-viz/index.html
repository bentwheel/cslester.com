<!doctype html>
<html lang="en"><head>
    <title>The Actuarial Standards of Practice: A brief visual analysis</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../../css/theme.css"/>
    
</head>
<body>
        <div id="content" class="mx-auto"><header class="container mt-sm-5 mt-4 mb-4 mt-xs-1">
    <div class="row">
        <div class="col-sm-4 col-12 text-sm-right text-center pt-sm-4">
            <a href="../../" class="text-decoration-none">
                <img id="home-image" class="rounded-circle"
                    
                        
                            src="../../images/seth.jpg"
                        
                    
                />
            </a>
        </div>
        <div class="col-sm-8 col-12 text-sm-left text-center">
            <h2 class="m-0 mb-2 mt-4">
                <a href="../../" class="text-decoration-none">
                    
                        C. Seth Lester, ASA
                    
                </a>
            </h2>
            <p class="text-muted mb-1">
                
                    Actuarial generalist with experience in core pricing and reserving functions, financial reporting, data storytelling and visualization, actuarial AI/ML modeling, and public speaking.
                
            </p>
            <ul id="nav-links" class="list-inline mb-2">
                
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../resume/" title="Resume">Resume</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../posts/" title="Projects">Projects</a>
                    </li>
                
            </ul>
            <ul id="nav-social" class="list-inline">
                
                    <li class="list-inline-item mr-3">
                        <a href="https://www.linkedin.com/in/csethlester/" target="_blank">
                            <i class="fab fa-linkedin-in fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="http://github.com/bentwheel" target="_blank">
                            <i class="fab fa-github fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://www.twitter.com/sethlester/" target="_blank">
                            <i class="fab fa-twitter fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="mailto:cslester@gmail.com" target="_blank">
                            <i class="fas fa-envelope fa-1x text-muted"></i>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
    <hr />
</header>
<div class="container">
    <div class="pl-sm-4 ml-sm-5">
        <p>This content was generated using a <a href="http://rmarkdown.rstudio.com">R
Markdown</a> Notebook. The code / .RMD file
used to build this page, as well as additional documentation and
resources, are all located on <a href="https://github.com/bentwheel/asop-viz">my personal GitHub
page</a>. A <a href="https://www.linkedin.com/pulse/actuarial-standards-practice-brief-visual-analysis-c-seth-lester/">slightly revised version of
this content</a> was posted on LinkedIn.</p>
<h2 id="what-do-actuaries-do">What do actuaries do?</h2>
<p>I volunteered (with some eagerness) to teach the R training sessions to
the bright and talented “virtual” actuarial intern cohorts we have at
Cigna this year in our Philadelphia office, and I wanted to kick off the
presentation with a showcase of the flexibility and power that the R
language and RStudio IDE can bring to a project, all while providing my
spin on the so-called million-dollar question: <em>“What do actuaries do?”</em></p>
<p><strong>tl;dr: I’ve used a web scraper and a short little bit of R code to web
scrape the Actuarial Standards of Practice website and have put together
some visualizations of meta-information concerning how the ASOPs are
interconnected and a timeline of when the ASOPs in effect today became
effective.</strong></p>
<p>First off, I’ve only been asking this question for a handful of years
myself, so I don’t intend for my analysis here to come across with a
veneer of deep expertise; nor do I mean to pose this question with a
tremendous amount of context, and I certainly don’t intend to address
the question relative to what other financial professionals do, or what
data scientists do, though I admittedly have some strong feelings about
those questions, too. And, speaking of feelings, I’m obliged to state
that the opinions reflected within this document/post certainly do <em>not</em>
necessarily reflect the views of my employer. Also, the are not intended
to convey or otherwise represent the views of the <a href="http://soa.org">Society of
Actuaries</a>, the <a href="http://www.actuarialstandardsboard.org/">Actuarial Standards
Board</a>, or the <a href="http://actuary.org">American
Academy of Actuaries</a>.</p>
<h2 id="ontological-information-is-information-too">Ontological information is information, too!</h2>
<p>I offer up first the fairly uncontroversial proposition that
<strong>information about what practices and standards a profession values is
embedded in the profession’s standards of practice</strong>. Since these
implicit value statements of a profession are likely to reflect the
consensus of experts operating within that profession, I argue that the
question <em>“What do actuaries do?”</em> can be answered by information
embedded within the <a href="http://www.actuarialstandardsboard.org/standards-of-practice/">Actuarial Standards of
Practice</a>,
the living, breathing rule-book of the actuarial profession.</p>
<p>And, if the ASOPs are a living, breathing rule-book of the actuarial
profession, do they come about in an order and chronology reflecting the
need for the actuarial profession to respond to events such as the
passage of the Afforable Care Act or the 2008 Global Financial Crisis?
Have you ever wondered how many ASOPs have come effective in the last 10
years? 20 years? <em>Just how often does the actuarial community update its
standards?</em></p>
<figure class="img-thumbnail"><a href="./timeline.png">
    <img src="./timeline.png"
         alt="Timeline of the ASOPs" width="100%"/> </a><figcaption>
            <p>Timeline of the ASOPs</p>
        </figcaption>
</figure>

<p>The Actuarial Standards of Practice (hereafter: ASOPs) on the main
landing page are helpfully categorized by practice area, labeled with
their most recent effective dates, and presented in order with titles.
Within each individual ASOP, you’ll find the content endorsed by the
Actuarial Stnadards Board that is meant to construe a standard of
actuarial practice. But one interesting feature of the ASOPs is that
they reference one another. In fact, they do this <em>quite a bit</em>. And
this got me wondering one day: <em>which ASOP is referenced the most?</em></p>
<figure class="img-thumbnail"><a href="./grid.png">
    <img src="./grid.png"
         alt="ASOP Reference Grid" width="100%"/> </a><figcaption>
            <p>ASOP Reference Grid</p>
        </figcaption>
</figure>

<p>As we can see, the ASOPs most heavily referenced are ASOPs No. 23 and
41, regarding <strong>Data Quality</strong> and <strong>Actuarial Communications</strong>. These
ASOPs are at the heart of the interconnected network of ASOPs. Also,
note that ASOPs 23 and 41 cite no other ASOPs besides one another, so
not only are they well-referenced by all the other ASOPs, but you can
think of them as “axiomatic” ASOPs, too.</p>
<p>The charts above use meta-information and information about the
ontological structure of the ASOPs (i.e., how they are interconnected)
to answer these questions, and the code to develop them follows.
Finally, I would go out on a limb and conclude from all this that ASOPs
23 and 41 are <em>foundational</em> to the actuarial profession (no matter your
practice area).</p>
<p>So when it comes to the initial question of <em>&ldquo;What do actuaries do?</em>,
it’s abundantly clear that <strong>data stewardship</strong> and <strong>communication</strong>
are critical pillars of all actuarial practice.</p>
<h2 id="the-code">The code</h2>
<p>In the following code (which you can clone from Git, linked above, and
follow along with on your own, or just scroll-through here), we will:</p>
<ol>
<li>Use the <strong>rvest</strong> package in conjunction with the <strong>SelectorGadget
Chrome Extension</strong> to efficiently scrape meta-information from the
Actuarial Standards of Practice hosted on the Actuarial Standards
Board website.</li>
<li>Assemble a corpus of data to build a visual representation of this
meta-information.</li>
<li>Use various visualizations to capture insights and ontological
meta-information concerning the ASOPs as they are written today.</li>
</ol>
<p>While my initial goal from this project was to showcase the hunch I’ve
long had that ASOP No. 23 is the most internally referenced ASOP, the
project goal has expanded to show the value in analyzing
meta-information and the ontological relationships between otherwise
seemingly mundane representations of information that we interface with
regularly.</p>
<h2 id="getting-asop-meta-information">Getting ASOP Meta-Information</h2>
<p>We will be using <strong>rvest</strong> to scrape information from the Actuarial
Standards Board’s website, and we’ll be using the <strong>tidyverse</strong> suite of
packages to do a lot of the data twisting and wrangling required to
render the charts above in <em>ggplot</em>.</p>
<pre><code># Load the tidyverse package to get our usual suite of powerful data-wranglin', piping, plotting, and otherwise immensely useful toolkits.
library(tidyverse)

## ── Attaching packages ───────────────────────────────────────────────────────── tidyverse 1.3.0 ──

## ✓ ggplot2 3.2.1     ✓ purrr   0.3.3
## ✓ tibble  2.1.3     ✓ dplyr   0.8.3
## ✓ tidyr   1.0.0     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.4.0

## ── Conflicts ──────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()

# Load rvest to do webscraping.
library(rvest)

## Loading required package: xml2

## 
## Attaching package: 'rvest'

## The following object is masked from 'package:purrr':
## 
##     pluck

## The following object is masked from 'package:readr':
## 
##     guess_encoding

# Aim our scraper at the main URL for the ASB&quot;s &quot;ASOP Table of Contents&quot; page and read in HTML source content as a very large string value
asb_main_landing_url &lt;- &quot;http://www.actuarialstandardsboard.org/standards-of-practice/&quot;
asb_main_landing_html &lt;- read_html(asb_main_landing_url)

# Using SelectorGadget, I've identified the hyperlinks to all the 56 ASOP's from this page
asop_links &lt;- html_nodes(asb_main_landing_html, &quot;.item-meta-links a:nth-child(1)&quot;)

# asop_links is a list object of 56 hypertext tags to the 56 published ASOPs that are either in effect, repealed, or soon-to-be-effective (including the new Modeling ASOP!)

# Now we parse the markup to get to 56 unique URL string values corresponding with the href attribute contained in our 56-element list of &lt;a&gt; tags
asop_urls &lt;- html_attrs(asop_links)

# While we're at it, we're going to want to make sure we have our ontological ducks in a row when it comes time to organize the data. So, let's stand up a quick reference tibble that assigns ASOP numbers to ASOP links.
asop_table &lt;- asop_urls %&gt;% 
  tibble(asop_urls = unlist(.)) %&gt;% 
  mutate(asop_number = row_number()) 

# Let's get titles now and build this into our data table
asop_titles &lt;- html_nodes(asb_main_landing_html, &quot;h4&quot;) %&gt;% 
  html_text(trim=T)

asop_table &lt;- asop_titles %&gt;% 
  tibble(asop_title = .) %&gt;% 
  mutate(asop_number = row_number()) %&gt;% 
  inner_join(asop_table)

## Joining, by = &quot;asop_number&quot;

# the last line of this chain is an inner- instead of left-join - the purpose here is to shed some none-ASOPs that we picked up in our scrape that are rendered under &lt;h4&gt; HTML tags.

# Finally, actually cracking open the source can reveal more info than SelectorGadget, sometimes. Here I see a &lt;div class&gt; named .item-meta that can get me the category/categories of the ASOP, as well as the date of adoption and adoption status.

# To package all this meta-data up the tidy way, we'll lean on purrr
library(purrr)
library(stringr)
library(lubridate)

## 
## Attaching package: 'lubridate'

## The following object is masked from 'package:base':
## 
##     date

# Bear with me, this is kind of a mess and there might be a better way to do this, but here we go!
asop_meta &lt;- html_nodes(asb_main_landing_html, &quot;.item-meta&quot;)
asop_meta_content &lt;- html_children(asop_meta) %&gt;% 
  map(html_text) %&gt;% 
  enframe() %&gt;% 
  filter(str_sub(value, 1, 4) != &quot;View&quot;) %&gt;% 
  separate(value, into=c(&quot;meta_key&quot;, &quot;meta_value&quot;), sep=&quot;: &quot;) %&gt;% 
  mutate(asop_number = ceiling(name/4)) %&gt;% 
  select(-name) %&gt;% 
  pivot_wider(names_from=meta_key, values_from=meta_value)

#Category is delimited on spaces, so we need to break that up. The status field has the same value all the way down, so let's ditch it. And to make this super pliable, we'll just arrange the categories as boolean fields.

asop_metadata &lt;- asop_meta_content %&gt;% 
  select(-Status) %&gt;% 
  ungroup() %&gt;% 
  mutate(category.health = str_detect(Category, &quot;Health&quot;),
         category.life = str_detect(Category, &quot;Life&quot;),
         category.casualty = str_detect(Category, &quot;Casualty&quot;),
         category.general = str_detect(Category, &quot;General&quot;),
         category.erm = str_detect(Category, &quot;ERM&quot;),
         category.pension = str_detect(Category, &quot;Pension&quot;),
         repealed = str_detect(Category, &quot;Repealed&quot;),
         forthcoming = str_detect(Category, &quot;Soon-To-Be-Effective-ASOPs&quot;),
         eff_date=lubridate::mdy(`Effective Date`),
         category.level = as_factor(str_replace_all(Category, &quot;[:space:]&quot;, &quot;, &quot;))) %&gt;% 
  select(-Category, -`Effective Date`)


# Finally we can stick this on the end of our existing table
final_asop_summary_table &lt;- asop_table %&gt;% 
  left_join(asop_metadata) %&gt;% 
  select(-.)

## Joining, by = &quot;asop_number&quot;
</code></pre>
<p>And with that, we’ve got a pretty great summary table of the ASOPs,
their titles, their practice area relevance metadata, and their
effective dates, as well as a web URL in which to go digging for more
information specific to the ASOP.</p>
<p>That’s what we’ll do next, iteratively, until we’ve harvested a rich set
of data concerning the ASOPs. For ASOPs 1-56, we’re going to iteratively
create a robust tibble of information for each ASOP, and when we’re done
with all 56 pages, we’ll have a list of tibbles that we can rbind onto
the end of our table.</p>
<p>I’ve generally found that it’s always a good idea to sketch out a rough
idea of the final data form you’re after. Especially prior to diving
into the data wrangling process. So what I want when this is all said
and done is our starter tibble from the last section, plus a column of
tibbles containing just one field (asop_refs) containing the individual
references made to other ASOPs within the one being currently scraped.</p>
<p>This field will list one record per mention of each ASOP within its
contents, with repetition allowed. We’ll use purrr package features to
consolidate and summarize the total number of references within each
document when it’s all done.</p>
<p>From this, I will do a little more twisting to build out a simple 56 x
56 reference grid, showing the number of references made by row-listed
ASOPs about their column-listed counterparts. (If this doesn’t track
now, just hang in there.)</p>
<p>Though this reference grid is useful for displaying, it’s almost
absolutely useless for making meaningful vizualizations. For that, we’ll
need to tidy the data: in other words, we’ll pivot on our reference grid
until every single piece of information exists on just one line. In
other words, we’ll need to arrive at a final format that has three
primary fields: asop_number, asop_refs, and num_refs.</p>
<p>We can choose to left-join on our summary ASOP meta-information table we
built above if we want to embellish our visualizations of the ASOPs any
further.</p>
<pre><code># One super neat package in R that really unlocks its power is the purrr package.
# We would normally iterate using a for-loop-ish structure through our URLs, parsing one at a time. We can set up instead a mapping function to do this for us that takes in a list of URLs, and for each item int he list, scrapes the URL for the necessary parts, and then returns a corresponding tibble for each URL - packaged as one consise list of tibbles.

map_reference_tibble &lt;- function(url) {
  
  # Uncomment this line for individual testing.
  #asop_url &lt;- final_asop_summary_table$asop_urls[42]
  asop_url &lt;- url
  asop_html &lt;- read_html(asop_url)
  asop_content &lt;- toString(html_text(html_nodes(asop_html, &quot;.sentry p&quot;)))
  
  # Regex is always amazing and elegant and fast.
  asop_refs &lt;- str_match_all(asop_content, &quot;(?&lt;=ASOP No. )[:digit:]{1,2}&quot;) %&gt;% 
    unlist() %&gt;% 
    tibble(asop_refs = .)
  
  # Need to cover when multiple ASOPs are referenced, too:
  asop_mult_refs1 &lt;- str_match_all(asop_content, &quot;(?&lt;=ASOP Nos. )[:digit:]{1,2}&quot;) %&gt;% 
    unlist() %&gt;% 
    tibble(asop_refs = .)
  asop_mult_refs2 &lt;- str_match_all(asop_content, &quot;(?&lt;=ASOP Nos. [:digit:]{1,2} and )[:digit:]{1,2}&quot;) %&gt;% 
    unlist() %&gt;% 
    tibble(asop_refs = .)
  
  # Union all our referenced ASOP nos.
  asop_all_refs &lt;- asop_refs %&gt;% 
    union_all(asop_mult_refs1) %&gt;% 
    union_all(asop_mult_refs2)
  
  # return our tibble
  asop_all_refs
}

# Let's test our function on the well-known Data Quality ASOP
# foo &lt;- map_reference_tibble(final_asop_summary_table$asop_urls[23])

# Looks like we're in business. Let's run the map on the entire ASOP meta-table.
asop_reference_urls &lt;- as.list(final_asop_summary_table$asop_urls)

# This one takes some time to run - but not too long. Enjoy a nice snack and think about how much more this rules than a for loop
asop_references_nested &lt;- asop_reference_urls %&gt;% 
  map(map_reference_tibble) %&gt;% 
  enframe()

# Finally, we left-join back to our primary table
final_asop_summary_table &lt;- final_asop_summary_table %&gt;% 
  left_join(asop_references_nested, by=c(&quot;asop_number&quot;=&quot;name&quot;))
</code></pre>
<p>Whew! Wasn’t that fun? So now we have all the information we need to
start putting together some visualizations. But first, wouldn’t it be a
shame if we didn’t practice a little ASOP No. 23 on our new dataset?
Let’s start out with some quick validation.</p>
<p>First, the ASOPs are heavily self-referential. So we should make sure
that a good number of the reference tables contains at least one
reference to itself.</p>
<pre><code>validate_data1 &lt;-final_asop_summary_table %&gt;% 
  ungroup() %&gt;% 
  unnest(value) %&gt;% 
  group_by(asop_number, asop_refs) %&gt;% 
  summarize(count_refs = n()) %&gt;% 
  ungroup() %&gt;% 
  filter(asop_number == asop_refs) %&gt;% 
  distinct(asop_number) 

validate_data2 &lt;- tibble(asop_number=seq(1:56)) %&gt;% 
  anti_join(validate_data1)

## Joining, by = &quot;asop_number&quot;

# ASOPs 26, 29, 30, 32, 33, 39, 51 appear to not contain the string literal &quot;ASOP No. X&quot;, where X = their own number. I spot checked them all manually and this is true!
</code></pre>
<h2 id="drawing-plots">Drawing plots</h2>
<p>Generally I’ve spot-checked some of the other records and I have a
pretty good feeling overall about the graphical representation we’ve set
out to do.</p>
<p>So, now, let’s make some pretty visualizations! The first thing I’m
going to do is put together a quick timeline of ASOPs, since I have that
information readily available right off the bat.</p>
<pre><code>library(ggalt)

## Registered S3 methods overwritten by 'ggalt':
##   method                  from   
##   grid.draw.absoluteGrob  ggplot2
##   grobHeight.absoluteGrob ggplot2
##   grobWidth.absoluteGrob  ggplot2
##   grobX.absoluteGrob      ggplot2
##   grobY.absoluteGrob      ggplot2

library(ggrepel)
library(ggthemes)
library(extrafont)

## Registering fonts with R

#font_import()

timeline.data &lt;- final_asop_summary_table %&gt;% 
  distinct(asop_number, asop_title, eff_date, category.level, repealed) %&gt;% 
  filter(!repealed) %&gt;% 
  arrange(eff_date) %&gt;% 
  mutate(display_title = paste0(&quot;No. &quot;, asop_number, &quot;: &quot;, asop_title),
         display_height = 0)

wrapper &lt;- function(x) str_wrap(x, width=25)

timeline &lt;- timeline.data %&gt;% 
  ggplot(aes(x = as.Date(eff_date), 
             y = display_height,
             label = wrapper(display_title))) +
  geom_hline(color = &quot;red&quot;, yintercept = 0, size=1, alpha=0.6) +
  geom_point(size=1.2, aes(color=category.level)) +
  geom_label_repel(aes(fill = category.level), 
                   color=&quot;white&quot;, size=1.9, segment.color = &quot;black&quot;,
                   alpha=.95, max.iter = 4000, segment.alpha = 0.6,
                   show.legend =F) +
  labs(title = &quot;A Timeline of the Actuarial Standards of Practice&quot;,
       x = &quot;Date Effective&quot;,
       y = &quot;&quot;,
       color = &quot;ASOP Category&quot;,
       fill = &quot;ASOP Category&quot;,
       caption = &quot;Source: Actuarial Standards Board (www.actuarialstandardsboard.org)&quot;) +
  scale_fill_viridis_d() +
  scale_color_viridis_d() +
  scale_x_date(limits = c(ymd(19950101), ymd(20201231)), 
               breaks=seq.Date(from=ymd(19950101), to=ymd(20221231), by=&quot;2 years&quot;),
               labels = scales::date_format(format=&quot;%Y&quot;)) +
  theme_tufte() +
  theme(legend.position=&quot;bottom&quot;, legend.box = &quot;horizontal&quot;, legend.text=element_text(size=7),
        legend.title = element_text(size = 8), axis.text.y = element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.ticks.y = element_blank(), text=element_text(family=&quot;Courier Prime&quot;)) 
        
timeline
</code></pre>
<p><img src="Visualizing-the-ASOPs_files/figure-markdown_strict/asop-timeline-viz-1.png" alt=""></p>
<pre><code>ggsave(&quot;timeline.png&quot;, width=14, height=5)

grid.data &lt;- final_asop_summary_table %&gt;% 
  unnest(value) %&gt;% 
  group_by(asop_number, asop_title, category.level, asop_refs) %&gt;% 
  summarize(count_refs = n()) %&gt;% 
  filter(asop_number != asop_refs) %&gt;% 
  mutate(asop_refs = as.numeric(asop_refs),
         display_name_x = paste0(&quot;ASOP No. &quot;, formatC(asop_number, &quot;%0d&quot;, width = 2)),
         display_name_y = paste0(&quot;ASOP No. &quot;, formatC(asop_refs, &quot;%0d&quot;, width=2))) 

grid &lt;- grid.data %&gt;% 
  ggplot(aes(x = fct_reorder(display_name_x, desc(asop_number)), 
             y = fct_reorder(display_name_y, asop_refs),
             fill = as.integer(count_refs))) + 
  geom_tile(aes(width = .9, height=.9), size = 0.3, color=&quot;grey&quot;) +
  labs(title = &quot;How Do ASOPs Reference Other ASOPs?&quot;,
       y = &quot;...reference these ASOPs&quot;,
       x = &quot;These ASOPs...&quot;,
       fill = &quot;Number of unique references&quot;,
       caption = &quot;Source: Actuarial Standards Board (www.actuarialstandardsboard.org)&quot;) +
  scale_fill_viridis_c(label = scales::comma) +
  theme_tufte() +
  theme(legend.text=element_text(size=7),
        text = element_text(family=&quot;Courier Prime&quot;),
        legend.title = element_text(size = 8),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle=90),
        axis.line = element_line(color=&quot;black&quot;)) +
  guides(fill = guide_colorbar(barwidth = 0.75, barheight = 15,
                               frame.color = &quot;black&quot;,
                               direction = &quot;vertical&quot;)) +
  coord_flip()

grid
</code></pre>
<p><img src="Visualizing-the-ASOPs_files/figure-markdown_strict/grid-view-1.png" alt=""></p>
<pre><code>ggsave(&quot;grid.png&quot;, height=13, width=11)
</code></pre>

    </div>

            </div>
        </div><footer class="text-center pb-1">
    <small class="text-muted">
        
            &copy; Copyright 2020, C. S. Lester
        
        <br>
        Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
        and <a href="https://github.com/austingebauer/devise" target="_blank">Devise</a>
    </small>
</footer>
</body>
</html>
